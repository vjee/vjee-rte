/**
 * @vjee/rte v1.0.0
 * (c) 2019-2019 vjee
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vjeeRTE=t()}(this,function(){"use strict";class e{constructor(){this.savedSelectionRange=null,this.isFakeBackgroundEnabled=!1}static get(){return window.getSelection()}save(){this.savedSelectionRange=e.range}restore(){if(!this.savedSelectionRange)return;const e=window.getSelection();e.removeAllRanges(),e.addRange(this.savedSelectionRange)}static findParentTag(e,t=null,n=10){const o=window.getSelection();let s=null;if(!o||!o.anchorNode||!o.focusNode)return null;return[o.anchorNode,o.focusNode].forEach(o=>{let i=n;for(;i>0&&o.parentNode&&(o.tagName!==e||(s=o,t&&o.classList&&!o.classList.contains(t)&&(s=null),!s));)o=o.parentNode,i--}),s}static expandToTag(e){const t=window.getSelection();console.log(t),t.removeAllRanges();const n=document.createRange();n.selectNodeContents(e),t.addRange(n)}static get text(){return window.getSelection?window.getSelection().toString():""}static get range(){const e=window.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null}static get rect(){let e={x:0,y:0,width:0,height:0};const t=window.getSelection().getRangeAt(0).cloneRange();return t.getBoundingClientRect&&(e=t.getBoundingClientRect()),e}}class t{constructor(e,t){this.$button=e,this.toolbar=t}surround(){const t=e.range,n=e.findParentTag(this.nodeName.toUpperCase());n?this.unwrap(n):this.wrap(t),this.checkState()}wrap(t){const n=document.createElement(this.nodeName);n.appendChild(t.extractContents()),t.insertNode(n),e.expandToTag(n)}unwrap(t){e.expandToTag(t);const n=e.range,o=n.extractContents();t.parentNode.removeChild(t),n.insertNode(o);const s=window.getSelection();s.removeAllRanges(),s.addRange(n)}checkState(){e.findParentTag(this.nodeName.toUpperCase())?this.$button.classList.add("active"):this.$button.classList.remove("active")}}class n extends t{constructor(e,t){super(e,t),this.name="Bold",this.nodeName="b",this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"fill=currentFill /><path d="M0 0h24v24H0z"fill=none /></svg>'}}class o extends t{constructor(e,t){super(e,t),this.name="Italic",this.nodeName="i",this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z"fill=none /><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"fill=currentFill /></svg>'}}class s extends t{constructor(e,t){super(e,t),this.name="Mark",this.nodeName="mark",this.icon='<svg height=20 viewBox="0 0 24 24"width=20 xmlns=http://www.w3.org/2000/svg><path d="M17.75 7L14 3.25l-10 10V17h3.75l10-10zm2.96-2.96c.39-.39.39-1.02 0-1.41L18.37.29c-.39-.39-1.02-.39-1.41 0L15 2.25 18.75 6l1.96-1.96z"fill=currentFill /><path d="M0 0h24v24H0z"fill=none /><path d="M0 20h24v4H0z"fill=currentFill fill-opacity=.36 /></svg>'}}class i extends t{constructor(e,t){super(e,t),this.name="Link",this.nodeName="a",this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z"fill=none /><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"fill=currentFill /></svg>'}}class a{constructor(e,t){this.toolInstances=[],this.$node=e,this.selection=t,this.$toolbar=this.createToolbar(),[n,o,s,i].forEach(e=>{const t=this.createToolbarButton(e);this.$toolbar.firstChild.appendChild(t)}),document.body.appendChild(this.$toolbar)}createToolbar(){const e=document.createElement("div");e.classList.add("vjee-rte__toolbar"),e.classList.add("vjee-rte__toolbar--hidden");const t=document.createElement("div");return t.classList.add("vjee-rte__toolbar__buttons"),e.appendChild(t),e}createToolbarButton(e){const t=document.createElement("button");t.classList.add("vjee-rte__toolbar__button");const n=new e(t,this);return this.toolInstances.push(n),t.title=n.name,t.innerHTML=n.icon,t.addEventListener("mouseup",()=>{n.surround()}),t}allowedToShow(){const t=e.get(),n=e.text;if(t.isCollapsed||n.length<1)return!1;const o=t.anchorNode.parentElement;return!!this.$node.contains(o)}checkStates(){this.toolInstances.forEach(e=>{e.checkState&&e.checkState()})}move(){const t=e.rect,n={x:t.left+t.width/2,y:t.top+t.height};this.$toolbar.style.left=Math.floor(n.x)+"px",this.$toolbar.style.top=Math.floor(n.y)+"px"}open(){this.$toolbar.classList.remove("vjee-rte__toolbar--hidden")}close(){this.$toolbar.classList.add("vjee-rte__toolbar--hidden"),this.toolInstances.forEach(e=>{e.clearUI&&e.clearUI()})}destroy(){this.$toolbar.parentNode.removeChild(this.$toolbar)}}return function(t){"string"==typeof t&&(t=document.querySelector(t));const n=new e,o=new a(t,n);function s(){if(!o.allowedToShow())return o.close();n.save(),o.move(),o.open(),o.checkStates()}return t.classList.add("vjee-rte"),t.contentEditable="true",window.addEventListener("mouseup",s),window.addEventListener("keyup",s),function(){t.classList.remove("vjee-rte"),t.contentEditable="false",window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),o.destroy()}}});
