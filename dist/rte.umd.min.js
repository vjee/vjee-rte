/**
 * @vjee/rte v0.1.0-alpha.3
 * (c) 2019-2019 vjee
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).vjeeRTE=e()}(this,function(){"use strict";class t{static findParentTag(e,n=null,o=10){const s=t.selection;let a=null;if(!s||!s.anchorNode||!s.focusNode)return null;return[s.anchorNode,s.focusNode].forEach(t=>{let s=o;for(;s>0&&t.parentNode&&(t.tagName!==e||(a=t,n&&t.classList&&!t.classList.contains(n)&&(a=null),!a));)t=t.parentNode,s--}),a}static expandToTag(e){const n=t.selection;n.removeAllRanges();const o=document.createRange();o.selectNodeContents(e),n.addRange(o)}static containsHTML(e){const n=t.range.cloneContents();return e?!!n.querySelector(e):!!n.children.length}static get selection(){return window.getSelection()}static get text(){return t.selection.toString()}static get range(){const e=t.selection;return e&&e.rangeCount?e.getRangeAt(0):null}static get rect(){let e={x:0,y:0,width:0,height:0};const n=t.selection.getRangeAt(0).cloneRange();return n.getBoundingClientRect&&(e=n.getBoundingClientRect()),e}}class e{constructor(t,e){this.$button=t,this.toolbar=e}surround(){document.execCommand(this.commandName)}checkState(){const e=document.queryCommandState(this.commandName);this.$button.classList[e?"add":"remove"]("active"),this.$button.classList[t.containsHTML("mark")?"add":"remove"]("disabled")}}class n extends e{constructor(t,e){super(t,e),this.name="Bold",this.commandName="bold",this.shortcut=[["meta+66","meta+b"],["ctrl+66","ctrl+b"]],this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"fill=currentFill /><path d="M0 0h24v24H0z"fill=none /></svg>'}}class o extends e{constructor(t,e){super(t,e),this.name="Italic",this.commandName="italic",this.shortcut=[["meta+73","meta+i"],["ctrl+73","ctrl+i"]],this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z"fill=none /><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"fill=currentFill /></svg>'}}class s extends e{constructor(t,e){super(t,e),this.name="Underline",this.commandName="underline",this.shortcut=[["meta+85","meta+u"],["ctrl+85","ctrl+u"]],this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z"fill=none /><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"fill=currentFill /></svg>'}}class a{constructor(t,e){this.$button=t,this.toolbar=e}surround(){const e=t.range,n=t.findParentTag(this.nodeName.toUpperCase());n?this.unwrap(n):this.wrap(e),this.checkState()}wrap(e){const n=document.createElement(this.nodeName);n.appendChild(e.extractContents()),e.insertNode(n),t.expandToTag(n)}unwrap(e){t.expandToTag(e);const n=t.range,o=document.createDocumentFragment();for(let t=0;t<e.childNodes.length;t++)o.appendChild(e.childNodes[t]);n.extractContents(),e.parentNode.removeChild(e),n.insertNode(o);const s=t.selection;s.removeAllRanges(),s.addRange(n)}checkState(){const e=t.findParentTag(this.nodeName.toUpperCase());this.$button.classList[e?"add":"remove"]("active"),this.$button.classList[t.containsHTML()?"add":"remove"]("disabled")}}class r extends a{constructor(t,e){super(t,e),this.nodeName="mark"}get name(){return"Mark"}get shortcut(){return[["alt+meta+72","alt+meta+h"],["ctrl+alt+72","ctrl+alt+h"]]}get icon(){return'<svg height=20 viewBox="0 0 24 18"width=20 xmlns=http://www.w3.org/2000/svg><path d="M17.75 7L14 3.25l-10 10V17h3.75l10-10zm2.96-2.96c.39-.39.39-1.02 0-1.41L18.37.29c-.39-.39-1.02-.39-1.41 0L15 2.25 18.75 6l1.96-1.96z"fill=currentFill /><path d="M0 0h24v24H0z"fill=none /></svg>'}}class c{constructor(t,e){this.$button=t,this.toolbar=e,this.name="Link",this.shortcut=[["meta+75","meta+k"],["ctrl+75","ctrl+k"]],this.icon='<svg height=24 viewBox="0 0 24 24"width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z"fill=none /><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"fill=currentFill /></svg>'}surround(){const e=t.range,n=t.findParentTag("A");n?this.unwrap(n):this.wrap(e),this.checkState()}wrap(t){const e=prompt("Link","https://");document.execCommand("createLink",!1,e)}unwrap(e){t.expandToTag(e),document.execCommand("unlink")}checkState(){const e=t.findParentTag("A");this.$button.classList[e?"add":"remove"]("active"),this.$button.classList[t.containsHTML("mark")?"add":"remove"]("disabled")}}class i{constructor(t,e){this.toolInstances=[],this.shortcuts={},this.$node=t,this.selection=e,this.$toolbar=this.createToolbar(),this.isMac=0===navigator.platform.toLowerCase().indexOf("mac"),[n,o,s,r,c].forEach(t=>{const e=this.createTool(t);this.$toolbar.firstChild.appendChild(e)}),document.body.appendChild(this.$toolbar)}createToolbar(){const t=document.createElement("div");t.classList.add("vjee-rte__toolbar"),t.classList.add("vjee-rte__toolbar--hidden");const e=document.createElement("div");return e.classList.add("vjee-rte__toolbar__buttons"),t.appendChild(e),t}createTool(t){const e=document.createElement("button");e.classList.add("vjee-rte__toolbar__button");const n=new t(e,this);this.toolInstances.push(n),e.title=n.name,e.innerHTML=n.icon;const o=()=>{e.classList.contains("disabled")||(n.surround(),this.checkStates())};if(e.addEventListener("click",o),n.shortcut){const{keys:t,label:s}=this.parseShortcut(n.shortcut);this.shortcuts[t]=o,e.title=`${n.name} (${s})`}return e}parseShortcut(t){const e=(t=t[this.isMac?0:1])[0];let n=t[1].replace("meta",this.isMac?"⌘":"⊞");return this.isMac&&(n=n.replace("ctrl","⌃").replace("alt","⌥").replace("shift","⇧").replace(/\+/g,"")),{keys:e,label:n.toUpperCase()}}allowedToShow(){const e=t.selection,n=t.text;if(e.isCollapsed||n.length<1)return!1;const o=e.anchorNode.parentElement;return!!this.$node.contains(o)}checkStates(){this.toolInstances.forEach(t=>{t.checkState&&t.checkState()})}move(){const e=t.rect,n={x:e.left+e.width/2,y:e.top+e.height};this.$toolbar.style.left=Math.floor(n.x)+"px",this.$toolbar.style.top=Math.floor(n.y)+"px"}open(){this.$toolbar.classList.remove("vjee-rte__toolbar--hidden")}close(){this.$toolbar.classList.add("vjee-rte__toolbar--hidden"),this.toolInstances.forEach(t=>{t.clearUI&&t.clearUI()})}destroy(){this.$toolbar.parentNode.removeChild(this.$toolbar)}}return function(e){"string"==typeof e&&(e=document.querySelector(e));const n=new t,o=new i(e,n),s=function(t,e=!1){return n=>{if(!n)return;e&&n.preventDefault();let o=[n.ctrlKey?"ctrl":void 0,n.altKey?"alt":void 0,n.shiftKey?"shift":void 0,n.metaKey?"meta":void 0,["Shift","Meta","Control","Option","Alt"].indexOf(n.key)>=0?void 0:n.keyCode].filter(Boolean);o.length>=2&&t&&t(o.join("+"),n)}}((t,e)=>{o.shortcuts[t]&&(e.preventDefault(),o.shortcuts[t]())});function a(t){if(!t.target.closest(".vjee-rte__toolbar__button")){if(!o.allowedToShow())return o.close();o.move(),o.open(),o.checkStates()}}return e.classList.add("vjee-rte"),e.contentEditable="true",window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("keydown",s),function(){e.classList.remove("vjee-rte"),e.contentEditable="false",window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("keydown",s),o.destroy()}}});
